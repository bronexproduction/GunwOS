CXX_TESTS_FLAGS=-std=c++17 -Wall -Wextra
CXX_FRAMEWORK_FLAGS=$(CXX_TESTS_FLAGS) -c
CXX_INCLUDE=-I$(TEST_FRAMEWORK_DIR)/include -I$(TEST_SHARED_DIR)

CXX_FRAMEWORK_LISTING=find $(TEST_FRAMEWORK_DIR)/src -name '*.cpp' -type f
CXX_SHARED_DIR_LISTING=find $(TEST_SHARED_DIR) -name '*.cpp' -type f
O_DIR_LISTING=find . -name '*.o' -type f

EXEC_TERMINATOR=\;

.PHONY: all clean run

CXX_FRAMEWORK_INPUT=$(shell $(CXX_FRAMEWORK_LISTING))
CXX_INPUT=$(shell $(CXX_DIR_LISTING))
CXX_INPUT+=$(shell $(CXX_SHARED_DIR_LISTING))

FRAMEWORK=$(BUILD_DIR)/gunwtest.a
EXECUTABLE=$(BUILD_DIR)/bootloader_tests

all: $(FRAMEWORK) $(EXECUTABLE)

$(FRAMEWORK):
	make -C $(TEST_FRAMEWORK_DIR) clean all

$(EXECUTABLE):
	g++ -o $@ $(CXX_TESTS_FLAGS) $(CXX_INCLUDE) $(CXX_INPUT) $(FRAMEWORK)

clean:
	rm -f $(FRAMEWORK)
	rm -f $(EXECUTABLE)

run:
	$(EXECUTABLE)
